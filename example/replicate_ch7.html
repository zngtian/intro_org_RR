<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-02-09 Thu 15:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Application of California School</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Zheng Tian" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">The Application of California School</h1>


<div id="outline-container-org479ec17" class="outline-2">
<h2 id="org479ec17"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This tutorial is to show how to estimate a multiple regression model
and perform linear hypothesis testing. The application is about the
test scores of the California school districts. We will use R to
replicate the multiple regression with this data set in Chapter 6, and
the hypothesis tests in Chapter 7, <a class='org-ref-reference' href="#StockWatson2011">StockWatson2011</a>.
</p>

<p>
Before running all R codes, we may first load all the packages.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #D0372D;">library</span>(AER)
<span style="color: #D0372D;">library</span>(foreign)
<span style="color: #D0372D;">library</span>(stargazer)
</pre>
</div>
</div>
</div>


<div id="outline-container-org1196aa3" class="outline-2">
<h2 id="org1196aa3"><span class="section-number-2">2</span> Reading the data and basic summary statistics</h2>
<div class="outline-text-2" id="text-2">
<p>
Let's first read the data into R and show some basic statistics.
</p>
</div>
<div id="outline-container-orga62f402" class="outline-3">
<h3 id="orga62f402">Read the STATA file</h3>
<div class="outline-text-3" id="text-orga62f402">
<p>
Since the data is stored as an STATA file with the extension
  "<code>.dta</code>", we read the data using <code>read.dta()</code> in the library of
  <code>foreign</code>.
</p>

<div class="org-src-container">
<pre class="src src-R">setwd(<span style="color: #008000;">"/Users/ztian/OneDrive/teaching/workshop/intro_org_RR/example"</span>)
classdata <span style="color: #D0372D;">&lt;-</span> read.dta(<span style="color: #008000;">"./data/caschool.dta"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a6de37" class="outline-3">
<h3 id="org3a6de37">Summary</h3>
<div class="outline-text-3" id="text-org3a6de37">
<p>
Upon reading the data, we often use <code>summary()</code> to see some basic
statistics. Here we are not going to show summary statistics of all
variables in the data set for the purpose of saving space, but only to
select several variables of interest in Chapters 6 and 7, including
test scores, <code>testscr</code>, student-teacher ratio, <code>str</code>, percentage of
English learners, <code>el_pct</code>, expenditure per pupil, <code>expn_stu</code>, and
percentage of students qualifying for free lunch, <code>mean_pct</code>.
</p>

<div class="org-src-container">
<pre class="src src-R">summary(classdata[c(<span style="color: #008000;">"testscr"</span>, <span style="color: #008000;">"str"</span>, <span style="color: #008000;">"el_pct"</span>, <span style="color: #008000;">"expn_stu"</span>, <span style="color: #008000;">"meal_pct"</span>)])
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">testscr</th>
<th scope="col" class="org-left">str</th>
<th scope="col" class="org-left">el_pct</th>
<th scope="col" class="org-left">expn_stu</th>
<th scope="col" class="org-left">meal_pct</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Min.   :605.5</td>
<td class="org-left">Min.   :14.00</td>
<td class="org-left">Min.   : 0.000</td>
<td class="org-left">Min.   :3926</td>
<td class="org-left">Min.   :  0.00</td>
</tr>

<tr>
<td class="org-left">1st Qu.:640.0</td>
<td class="org-left">1st Qu.:18.58</td>
<td class="org-left">1st Qu.: 1.941</td>
<td class="org-left">1st Qu.:4906</td>
<td class="org-left">1st Qu.: 23.28</td>
</tr>

<tr>
<td class="org-left">Median :654.5</td>
<td class="org-left">Median :19.72</td>
<td class="org-left">Median : 8.778</td>
<td class="org-left">Median :5215</td>
<td class="org-left">Median : 41.75</td>
</tr>

<tr>
<td class="org-left">Mean   :654.2</td>
<td class="org-left">Mean   :19.64</td>
<td class="org-left">Mean   :15.768</td>
<td class="org-left">Mean   :5312</td>
<td class="org-left">Mean   : 44.71</td>
</tr>

<tr>
<td class="org-left">3rd Qu.:666.7</td>
<td class="org-left">3rd Qu.:20.87</td>
<td class="org-left">3rd Qu.:22.970</td>
<td class="org-left">3rd Qu.:5601</td>
<td class="org-left">3rd Qu.: 66.86</td>
</tr>

<tr>
<td class="org-left">Max.   :706.8</td>
<td class="org-left">Max.   :25.80</td>
<td class="org-left">Max.   :85.540</td>
<td class="org-left">Max.   :7712</td>
<td class="org-left">Max.   :100.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-org58d6031" class="outline-2">
<h2 id="org58d6031"><span class="section-number-2">3</span> Plots</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-orgd9969ec" class="outline-3">
<h3 id="orgd9969ec">Create a matrix of scatterplots using <code>plot</code></h3>
<div class="outline-text-3" id="text-orgd9969ec">
<p>
We can create several scatterplots displayed in one graph with a
matrix form.
</p>

<div class="org-src-container">
<pre class="src src-R">oldpar <span style="color: #D0372D;">&lt;-</span> par(mfrow = c(2, 3))

plot(classdata$str, classdata$testscr, col = <span style="color: #008000;">"red"</span>,
     main = <span style="color: #008000;">"Student-teacher ratio vs test scores"</span>,
     xlab = <span style="color: #008000;">"Student-teacher ratio"</span>, ylab = <span style="color: #008000;">"Test scores"</span>)

plot(classdata$el_pct, classdata$testscr, col = <span style="color: #008000;">"blue"</span>,
     main = <span style="color: #008000;">"English learners vs test scores"</span>,
     xlab = <span style="color: #008000;">"Percentage of English learners"</span>,
     ylab = <span style="color: #008000;">"Test scores"</span>)

plot(classdata$expn_stu, classdata$testscr, col = <span style="color: #008000;">"green3"</span>,
     main = <span style="color: #008000;">"Expenditure per pupil vs test scores"</span>,
     xlab = <span style="color: #008000;">"Expenditure per pupil"</span>,
     ylab = <span style="color: #008000;">"Test scores"</span>)

plot(classdata$meal_pct, classdata$testscr, col = <span style="color: #008000;">"maroon"</span>,
     main = <span style="color: #008000;">"Free lunch vs test scores"</span>,
     xlab = <span style="color: #008000;">"Percentage of students with free lunch"</span>,
     ylab = <span style="color: #008000;">"Test scores"</span>)

plot(classdata$calw_pct, classdata$testscr, col = <span style="color: #008000;">"darkorange1"</span>,
    main = <span style="color: #008000;">"Public assistance vs test scores"</span>,
    xlab = <span style="color: #008000;">"Percentage of students in public assistance"</span>,
    ylab = <span style="color: #008000;">"Test scores"</span>)

par(oldpar)
</pre>
</div>


<div class="figure">
<p><img src="./scplotmat.png" alt="scplotmat.png" />
</p>
<p><span class="figure-number">Figure 1: </span>The scatterplots between several variables and test scores</p>
</div>


<p>
We can see that the codes above have some parts that are repeated in
each plotting command. So these repetitive work can be concisely
written in <code>for</code> a loop. The basic syntax of a <code>for</code> loop is
<code>for (var in seq) expr</code>.
</p>

<pre class="example">
xvars &lt;- c("str", "el_pct", "expn_stu", "meal_pct", "calw_pct")
yvars &lt;- c("testscr")

xlabels &lt;- c("Student-teacher ratio", "Percentage of English learners",
             "Expenditure per pupil", "Percentage of students with free lunch",
             "Percentage of students in the public assistant program")
ylabels &lt;- "Test scores"

titles &lt;- c("student-teacher ratio vs test scores",
            "English learners vs test scores",
            "Expenditure per pupil vs test scores",
            "Free lunch vs test scores vs test scores",
            "public assistance vs test scores")
colors &lt;- c("red", "green3", "blue", "maroon", "darkorange1")


op &lt;- par(mfrow = c(2, 3))
for (i in seq(along=xvars)) {
    fm &lt;- formula(paste(yvars, "~", xvars[i]))
    plot(fm, data = classdata, col = colors[i], main = titles[i],
         xlab = xlabels[i], ylab = ylabels)
}
par(op)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgd3f6d58" class="outline-2">
<h2 id="orgd3f6d58"><span class="section-number-2">4</span> Estimation</h2>
<div class="outline-text-2" id="text-4">
<p>
Let us first replicate the regression results in Equation (7.19). The
unit of the expenditure per pupil is dollars in the data set but it is
in thousand dollars in regression. So we need to convert the unit in
the data set by dividing <code>expn_stu</code> by 1000, which is done directly in
the formula.
</p>
</div>
<div id="outline-container-org83c01da" class="outline-3">
<h3 id="org83c01da">The OLS estimation</h3>
<div class="outline-text-3" id="text-org83c01da">
<div class="org-src-container">
<pre class="src src-R">model.76 <span style="color: #D0372D;">&lt;-</span> testscr ~ str + I(expn_stu / 1000) + el_pct
</pre>
</div>

<p>
Notice the function <code>I()</code> in the formula. The arithmetic operations,
+, *, :, /, and ^, have special meanings in R's formula. Using the
function <code>I()</code> protects the original arithmetic meanings of these
operations from being interpreted in terms of a formula.
</p>

<p>
The regression estimation can be done with <code>lm()</code> and use <code>summary()</code>
afterwards.
</p>

<div class="org-src-container">
<pre class="src src-R">res.model.76 <span style="color: #D0372D;">&lt;-</span> lm(model.76, data = classdata)
summary(res.model.76)
</pre>
</div>

<pre class="example">
Call:
lm(formula = model.76, data = classdata)

Residuals:
    Min      1Q  Median      3Q     Max
-51.340 -10.111   0.293  10.318  43.181

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)      649.57795   15.20572  42.719  &lt; 2e-16 ***
str               -0.28640    0.48052  -0.596  0.55149
I(expn_stu/1000)   3.86790    1.41212   2.739  0.00643 **
el_pct            -0.65602    0.03911 -16.776  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.35 on 416 degrees of freedom
Multiple R-squared:  0.4366,	Adjusted R-squared:  0.4325
F-statistic: 107.5 on 3 and 416 DF,  p-value: &lt; 2.2e-16
</pre>

<p>
We can extract some components in the reported results. Use <code>coef()</code> to
get the coefficient estimates, <code>resid()</code> to get the residuals, and <code>fitted()</code>
or <code>predict()</code> to get the fitted values. Alternatively, we can think the
<code>lm</code> and <code>summary.lm</code> objects returned by <code>lm()</code> and <code>summary()</code> are the
<code>list</code> object so that we can use the "$" operator to get each component of
the lists. Below are some examples of extracting regression results.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get some components of the results</span>
bhat <span style="color: #D0372D;">&lt;-</span> coef(res.model.76)
rsq <span style="color: #D0372D;">&lt;-</span> summary(res.model.76)$r.squared
adj.rsq <span style="color: #D0372D;">&lt;-</span> summary(res.model.76)$adj.r.squared
</pre>
</div>
</div>

<ul class="org-ul"><li><a id="orga7291ab"></a>Interpretation of the results<br  /><div class="outline-text-4" id="text-orga7291ab">
<p>
As for the coefficients
</p>
<ol class="org-ol">
<li>The intercept is <code>649.5779</code>, which is significant at
1% significance level. It does not have real meaning in this
application, just determining the position of the sample regression
line crossing the vertical axis.</li>
<li>The coefficient on <code>str</code> is <code>-0.2864</code>, implying that
increasing one more student per teacher would decrease test scores
by <code>0.2864</code> unit. However, this estimated
coefficient is not significant at the 10% level.</li>
<li>The coefficient on expenditure per pupil is <code>3.8679</code>,
significantly positive at the 5% level, implying that an increase in
expenditure per pupil by one thousand dollars lead to an increase
in test scores by <code>3.8679</code> unit.</li>
<li>The coefficient on the percentage of English learners is
<code>-0.656</code>, significantly negative at the 1% level,
implying that an increase in the percentage of English learners by
one percent results in a decrease of test scores by
<code>0.656</code>.</li>
</ol>

<p>
Besides, the \(R^2\) and \(\bar{R}^2\) are <code>0.4366</code> and
<code>0.4325</code>, respectively. Overall, the model explains
about 43% variation of test scores with the included explanatory
variables, which is modest in the sense that a little more than half
of the variation of test scores is not accounted for in the model.
</p>
</div></li></ul>
</div>

<div id="outline-container-org91adb40" class="outline-3">
<h3 id="org91adb40">The heteroskedasticity-consistent covariance matrix</h3>
<div class="outline-text-3" id="text-org91adb40">
<p>
Note that standard errors and t statisitcs reported by <code>summary()</code> are
the homoskedasticity-only s.e. and t's. The heteroskedasticity-robust
covariance matrix can be obtained by <code>vcovHC()</code> in the package of
<code>sandwich</code>.
</p>
<div class="org-src-container">
<pre class="src src-R">htvarm <span style="color: #D0372D;">&lt;-</span> vcovHC(res.model.76, type = <span style="color: #008000;">"HC1"</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">238.960380157595</td>
<td class="org-right">-6.66491920338914</td>
<td class="org-right">-20.7034584893236</td>
<td class="org-right">0.0818068203778049</td>
</tr>

<tr>
<td class="org-right">-6.66491920338933</td>
<td class="org-right">0.232394197515306</td>
<td class="org-right">0.40034628247013</td>
<td class="org-right">-0.00244872476838095</td>
</tr>

<tr>
<td class="org-right">-20.7034584893232</td>
<td class="org-right">0.400346282470112</td>
<td class="org-right">2.49868335516912</td>
<td class="org-right">-0.0102366018665727</td>
</tr>

<tr>
<td class="org-right">0.0818068203778026</td>
<td class="org-right">-0.00244872476838084</td>
<td class="org-right">-0.0102366018665727</td>
<td class="org-right">0.00101024993508859</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-org86ce83e" class="outline-2">
<h2 id="org86ce83e"><span class="section-number-2">5</span> Hypothesis tests</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-org3726d75" class="outline-3">
<h3 id="org3726d75">Testing a single coefficient</h3>
<div class="outline-text-3" id="text-org3726d75">
<p>
Running <code>summary(res.model.76)</code> can give you t-statistics for all
coefficients. However, as noted above, these t-statistics are the
homoskedasticity-only t-statistics. We should use the
heteroskedasticity-robust ones.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">homoskedasticity-only</span>
coeftest(res.model.76)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">heteroskedasticity-robust, t distribution</span>
cftest.t <span style="color: #D0372D;">&lt;-</span> coeftest(res.model.76, vcov = htvarm)
cftest.t

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">heteroskedasticity-robust, normal distribution</span>
cftest.n <span style="color: #D0372D;">&lt;-</span> coeftest(res.model.76, vcov = htvarm, df = <span style="color: #6434A3;">Inf</span>)
cftest.n
</pre>
</div>

<pre class="example">
t test of coefficients:

                   Estimate Std. Error  t value  Pr(&gt;|t|)
(Intercept)      649.577947  15.205719  42.7193 &lt; 2.2e-16 ***
str               -0.286399   0.480523  -0.5960  0.551489
I(expn_stu/1000)   3.867902   1.412122   2.7391  0.006426 **
el_pct            -0.656023   0.039106 -16.7755 &lt; 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

t test of coefficients:

                   Estimate Std. Error  t value Pr(&gt;|t|)
(Intercept)      649.577947  15.458343  42.0212  &lt; 2e-16 ***
str               -0.286399   0.482073  -0.5941  0.55277
I(expn_stu/1000)   3.867902   1.580722   2.4469  0.01482 *
el_pct            -0.656023   0.031784 -20.6397  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

z test of coefficients:

                   Estimate Std. Error  z value Pr(&gt;|z|)
(Intercept)      649.577947  15.458343  42.0212  &lt; 2e-16 ***
str               -0.286399   0.482073  -0.5941  0.55245
I(expn_stu/1000)   3.867902   1.580722   2.4469  0.01441 *
el_pct            -0.656023   0.031784 -20.6397  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>

<p>
We can see from the results above that
</p>
<ol class="org-ol">
<li>whether we use the homoskedasticity-only or
heteroskedasticity-robust variance matrices does not affect the
coefficient estimates because the calculation of these estimates
does not involve the variance matrices.</li>
<li>Using the homoskedasticity-only or
heteroskedasticity-robust variance matrices yields different
standard errors and t-statistics. Even though the
homoskedasticity-only standard errors of student-teacher ratios
seems smaller than the heteroskedasticity-robust ones, we cannot
say that the estimates with the homoskedasticity-only standard
errors are more efficient or precise because we are using a wrong
variance matrix in this case.</li>
<li>The p-values from t distribution and standard normal distribution
are slightly different, given the corresponding t-statistics are
identical in the two cases.</li>
</ol>
</div>
</div>
<div id="outline-container-org434deec" class="outline-3">
<h3 id="org434deec">Testing joint hypotheses</h3>
<div class="outline-text-3" id="text-org434deec">
</div><ul class="org-ul"><li><a id="orgee450e0"></a>Zero restrictions<br  /><div class="outline-text-4" id="text-orgee450e0">
<p>
Let's first test the joint zero restrictions.
\[ H_0:\, \beta_1 = 0, \beta_2 = 0 \text{ vs. } H_1: \beta_1 \neq 0
\text{ or } \beta_2 \neq 0 \]
</p>

<p>
We can use the function <code>linearHypothesis()</code> to test this and any linear
hypotheses.
</p>

<div class="org-src-container">
<pre class="src src-R">test1 <span style="color: #D0372D;">&lt;-</span> linearHypothesis(res.model.76,
            c(<span style="color: #008000;">"str = 0"</span>, <span style="color: #008000;">"I(expn_stu/1000) = 0"</span>),
            vcov = htvarm, test = <span style="color: #008000;">"F"</span>)
test1
test1.F <span style="color: #D0372D;">&lt;-</span> test1$F[2]
test1.p <span style="color: #D0372D;">&lt;-</span> test1$<span style="color: #008000;">"Pr(&gt;F)"</span>[2]
</pre>
</div>

<pre class="example">
Linear hypothesis test

Hypothesis:
str = 0
I(expn_stu/1000) = 0

Model 1: restricted model
Model 2: testscr ~ str + I(expn_stu/1000) + el_pct

Note: Coefficient covariance matrix supplied.

  Res.Df Df      F   Pr(&gt;F)
1    418
2    416  2 5.4337 0.004682 **
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>

<p>
The F-statistic is <code>5.4337</code> with the p-value as
<code>0.0047</code>, which is less than 1%. Therefore, we can
reject the null hypothesis at the 1% level.
</p>

<p>
Note that the F-statistic is computed with the heteroskedasticity-robust
variance matrix and tested against a F distribution of (2, 416) degree
of freedom.
</p>
</div></li>

<li><a id="orgb11b0c2"></a>linear restrictions<br  /><div class="outline-text-4" id="text-orgb11b0c2">
<p>
Let's test the following restriction,
\[ H_0:\, \beta_1 + \beta_2 = 0, H_1: \beta_1 + \beta_2 \neq 0 \]
</p>

<p>
We still use <code>linearHypothesis()</code>. But this time we use the argument
<code>white.adjust</code> for which we specify "hc1" and test against a Chi-squared
distribution with one degree of freedom. Therefore, what we get is a
Wald statistic.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">b1 + b2 = 0</span>
test2 <span style="color: #D0372D;">&lt;-</span> linearHypothesis(res.model.76,
            c(<span style="color: #008000;">"str + I(expn_stu/1000) = 0"</span>),
            white.adjust = <span style="color: #008000;">"hc1"</span>, test = <span style="color: #008000;">"Chisq"</span>)
test2
test2.x <span style="color: #D0372D;">&lt;-</span> test2$Chisq[2]
test2.p <span style="color: #D0372D;">&lt;-</span> test2$<span style="color: #008000;">"Pr(&gt;Chisq)"</span>[2]
</pre>
</div>

<pre class="example">
Linear hypothesis test

Hypothesis:
str  + I(expn_stu/1000) = 0

Model 1: restricted model
Model 2: testscr ~ str + I(expn_stu/1000) + el_pct

Note: Coefficient covariance matrix supplied.

  Res.Df Df  Chisq Pr(&gt;Chisq)
1    417
2    416  1 3.6319    0.05668 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>

<p>
The Wald statistic is <code>3.6319</code> and the p-value is
<code>0.0567</code>, which is less than 10% and greater than 5%.
That means that the null hypothesis can be rejected at the 10% level
but not at the 5% level. This result implies that the effects of
hiring more teachers on test scores could be to some extent similar to
increasing more expenditure per pupil.
</p>

<p>
The homoskedasticity-only F statistic can be computed without specifying
<code>vcov</code> or <code>white.adjust</code>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">homoskedasticity-only F</span>
test2.hm <span style="color: #D0372D;">&lt;-</span> linearHypothesis(res.model.76,
            c(<span style="color: #008000;">"str + I(expn_stu/1000) = 0"</span>),
            test = <span style="color: #008000;">"F"</span>)
test2.hm
</pre>
</div>

<pre class="example">
Linear hypothesis test

Hypothesis:
str  + I(expn_stu/1000) = 0

Model 1: restricted model
Model 2: testscr ~ str + I(expn_stu/1000) + el_pct

  Res.Df   RSS Df Sum of Sq      F  Pr(&gt;F)
1    417 86562
2    416 85700  1    862.09 4.1847 0.04142 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>

<p>
The homoskedasticity-only F test points to rejecting the null hypothesis
at both 5% and 10% levels.
</p>
</div></li></ul>
</div>
</div>


<div id="outline-container-org1b0c3dd" class="outline-2">
<h2 id="org1b0c3dd"><span class="section-number-2">6</span> Control variables and model specifications</h2>
<div class="outline-text-2" id="text-6">
<p>
In this section we estimate different models for the application of
test scores. The variable of interest is student-teacher ratios,
\(STR\). In the base specification, we include the percentage of
students who are English learners, \(PctEL\), and the percentage of
students who are eligible for free or subsidized lunch, \(LchPct\), as
control variables. An alternative control variable is the percentage
of students who receive public assistance.
</p>

<div class="org-src-container">
<pre class="src src-R">model1 <span style="color: #D0372D;">&lt;-</span> lm(testscr ~ str, data = classdata)
model2 <span style="color: #D0372D;">&lt;-</span> lm(testscr ~ str + el_pct, data = classdata)
model3 <span style="color: #D0372D;">&lt;-</span> lm(testscr ~ str + el_pct + meal_pct, data = classdata)
model4 <span style="color: #D0372D;">&lt;-</span> lm(testscr ~ str + el_pct + calw_pct, data = classdata)
model5 <span style="color: #D0372D;">&lt;-</span> lm(testscr ~ str + el_pct + meal_pct + calw_pct, data = classdata)
</pre>
</div>

<p>
We compute the heteroskedasticity-robust standard errors for the
coefficients in all model specifications. The function <code>vcovHC</code> is
used to get the heteroskedasticity-consistent covariance matrix (HCCM), in
which we set the argument <code>type</code> to be <code>HC1</code>. The
heteroskedasticity-robust standard errors of coefficients are the
square roots of the diagonal elements of these HCCMs.
</p>

<div class="org-src-container">
<pre class="src src-R">hccm1 <span style="color: #D0372D;">&lt;-</span> vcovHC(model1, type = <span style="color: #008000;">"HC1"</span>)
se1 <span style="color: #D0372D;">&lt;-</span> sqrt(diag(hccm1))

hccm2 <span style="color: #D0372D;">&lt;-</span> vcovHC(model2, type = <span style="color: #008000;">"HC1"</span>)
se2 <span style="color: #D0372D;">&lt;-</span> sqrt(diag(hccm2))

hccm3 <span style="color: #D0372D;">&lt;-</span> vcovHC(model3, type = <span style="color: #008000;">"HC1"</span>)
se3 <span style="color: #D0372D;">&lt;-</span> sqrt(diag(hccm3))

hccm4 <span style="color: #D0372D;">&lt;-</span> vcovHC(model4, type = <span style="color: #008000;">"HC1"</span>)
se4 <span style="color: #D0372D;">&lt;-</span> sqrt(diag(hccm4))

hccm5 <span style="color: #D0372D;">&lt;-</span> vcovHC(model5, type = <span style="color: #008000;">"HC1"</span>)
se5 <span style="color: #D0372D;">&lt;-</span> sqrt(diag(hccm5))
</pre>
</div>

<p>
Finally, the results for all models are displayed in Table
(\ref{table:tbl71}) that replicates Table 7.1 in Chapter 7. To create
a LaTeX table, we use the function <code>stargazer</code>.
</p>

<div class="org-src-container">
<pre class="src src-R">stargazer(model1, model2, model3, model4, model5,
          title = <span style="color: #008000;">"Results of regressions of test scores and class size"</span>,
          covariate.labels = c(<span style="color: #008000;">"student-teacher ratio"</span>,
                               <span style="color: #008000;">"percent English learners"</span>,
                               <span style="color: #008000;">"percent eligible for subsidized lunch"</span>,
                               <span style="color: #008000;">"percent on public assistance"</span>),
          dep.var.caption = <span style="color: #008000;">"average test scores in the district"</span>,
          se = list(se1, se2, se3, se4, se5), df = <span style="color: #6434A3;">FALSE</span>,
          font.size = <span style="color: #008000;">"small"</span>,
          header = <span style="color: #6434A3;">FALSE</span>,
          label = <span style="color: #008000;">"table:tbl71"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfdf4067" class="outline-2">
<h2 id="orgfdf4067"><span class="section-number-2">7</span> Appendix: R codes</h2>
<div class="outline-text-2" id="text-7">
<pre class="example">
library(AER)

# read the data files into R
# read the dta file
library(foreign)
classdata &lt;- read.dta("caschool.dta")
head(classdata)
str(classdata)

summary(classdata[, c("testscr", "str", "el_pct", "expn_stu", "meal_pct")])

model.76 &lt;- testscr ~ str + I(expn_stu / 1000) + el_pct
res.model.76 &lt;- lm(model.76, data = classdata)
summary(res.model.76)

# scatterplot
oldpar &lt;- par(mfrow = c(2, 2))

plot(classdata$str, classdata$testscr, col = "red",
     main = "student-teacher ratio vs test scores",
     xlab = "Student-teacher ratio", ylab = "Test scores")

plot(classdata$el_pct, classdata$testscr, col = "blue",
     main = "English learners vs test scores",
     xlab = "Percentage of English learners",
     ylab = "Test scores")

plot(classdata$expn_stu, classdata$testscr, col = "green",
     main = "Expenditure per pupil vs test scores",
     xlab = "Expenditure per pupil",
     ylab = "Test scores")

plot(classdata$meal_pct, classdata$testscr, col = "black",
     main = "Free lunch vs test scores",
     xlab = "Percentage of students with free lunch",
     ylab = "Test scores")

par(oldpar)

# do this in a loop
xvars &lt;- c("str", "el_pct", "expn_stu", "meal_pct")
yvars &lt;- c("testscr")

xlabels &lt;- c("Student-teacher ratio", "Percentage of English learners",
             "Expenditure per pupil", "Percentage of students with free lunch")
ylabels &lt;- "Test scores"

titles &lt;- c("student-teacher ratio vs test scores",
            "English learners vs test scores",
            "Expenditure per pupil vs test scores",
            "Free lunch vs test scores")
colors &lt;- c("red", "green3", "blue", "black")


op &lt;- par(mfrow = c(2, 2))
for (i in seq(along=xvars)) {
    fm &lt;- formula(paste(yvars, "~", xvars[i]))
    plot(fm, data = classdata, col = colors[i], main = titles[i],
         xlab = xlabels[i], ylab = ylabels)
}
par(op)


## # use pairs() or scatterplot.matrix() in car
## pairs(~ testscr +str + el_pct + expn_stu + meal_pct,
##       data = classdata)

## scatterplot.matrix(~ testscr +str + el_pct + expn_stu + meal_pct,
##                    data = classdata)


###############################################
###              estimation                 ###
###############################################

model.76 &lt;- testscr ~ str + I(expn_stu / 1000) + el_pct

res.model.76 &lt;- lm(model.76, data = classdata)
summary(res.model.76)

# get some components of the results
bhat &lt;- coef(res.model.76)
rsq &lt;- summary(res.model.76)$r.squared
adj.rsq &lt;- summary(res.model.76)$adj.r.squared

htvarm &lt;- vcovHC(res.model.76, type = "HC1")

# application of the FWL theorem
# purge the effect of English learners and expenditure per pupil
mod.fwl1 &lt;- lm(testscr ~ el_pct + I(expn_stu/1000), data = classdata)
mod.fwl2 &lt;- lm(str ~ el_pct + I(expn_stu/1000), data = classdata)
mod.fwl3 &lt;- lm(resid(mod.fwl1) ~ resid(mod.fwl2))

# test whether the FWL theorm works
# first check for the equality of the coefficient on str
if (abs(coef(res.model.76)[2] - coef(mod.fwl3)[2]) &lt; 1.0e-10) {
    cat("The coefficient on str is the same.\n")
    } else {
    cat("The FWL theorem fails? Check your step!\n")
}

# second check for the equality of residuals
if (all(abs(resid(mod.fwl3) - resid(res.model.76)) &lt; 1.0e-10)) {
    cat("The residuals are all the same.\n")
    } else {
    cat("The FWL theorem fails? Check your step!\n")
}


###############################################
###          hypothesis testing             ###
###############################################

# single coefficient test
# homoskedasticity-only
coeftest(res.model.76)

# heteroskedasticity-robust, t distribution
cftest.t &lt;- coeftest(res.model.76, vcov = htvarm)

# heteroskedasticity-robust, normal distribution
cftest.n &lt;- coeftest(res.model.76, vcov = htvarm, df = Inf)

# joint hypothesis
# b1 = 0, b2 = 0
test1 &lt;- linearHypothesis(res.model.76,
            c("str = 0", "I(expn_stu/1000) = 0"),
            vcov = htvarm, test = "F")
test1
test1.F &lt;- test1$F[2]
test1.p &lt;- test1$"Pr(&gt;F)"[2]

# b1 + b2 = 0
test2 &lt;- linearHypothesis(res.model.76,
            c("str + I(expn_stu/1000) = 0"),
            white.adjust = "hc1", test = "Chisq")
test2
test2.x &lt;- test2$Chisq[2]
test2.p &lt;- test2$"Pr(&gt;Chisq)"[2]

# homoskedasticity-only F
test2.hm &lt;- linearHypothesis(res.model.76,
            c("str + I(expn_stu/1000) = 0"),
            test = "Chisq")
test2.hm

#######################################################
##    Control variables and model specifications     ##
#######################################################

# replicate Table 7.1
model1 &lt;- lm(testscr ~ str, data = classdata)
model2 &lt;- lm(testscr ~ str + el_pct, data = classdata)
model3 &lt;- lm(testscr ~ str + el_pct + meal_pct, data = classdata)
model4 &lt;- lm(testscr ~ str + el_pct + calw_pct, data = classdata)
model5 &lt;- lm(testscr ~ str + el_pct + meal_pct + calw_pct, data = classdata)

hccm1 &lt;- vcovHC(model1, type = "HC1")
se1 &lt;- sqrt(diag(hccm1))

hccm2 &lt;- vcovHC(model2, type = "HC1")
se2 &lt;- sqrt(diag(hccm2))

hccm3 &lt;- vcovHC(model3, type = "HC1")
se3 &lt;- sqrt(diag(hccm3))

hccm4 &lt;- vcovHC(model4, type = "HC1")
se4 &lt;- sqrt(diag(hccm4))

hccm5 &lt;- vcovHC(model5, type = "HC1")
se5 &lt;- sqrt(diag(hccm5))

library(stargazer)
stargazer(model1, model2, model3, model4, model5,
          title = "Results of regressions of test scores and class size",
          covariate.labels = c("student-teacher ratio",
                               "percent English learners",
                               "percent eligible for subsidized lunch",
                               "percent on public assistance"),
          dep.var.caption = "average test scores in the district",
          se = list(se1, se2, se3, se4, se5), df = FALSE,
          font.size = "small",
          label = "table:tbl71")
</pre>


<p>
<h1 class='org-ref-bib-h1'>Bibliography</h1>
<ul class='org-ref-bib'><li><a id="StockWatson2011">[StockWatson2011] Stock & , Introduction to Econometrics, Addison Wesley Longman (2011).</a></li>
</ul>

</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Zheng Tian</p>
<p class="date">Created: 2017-02-09 Thu 15:57</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
